<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDD Claims Processing System - Visualization Dashboard</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light-border.css">
    <script src="https://unpkg.com/intro.js@7/minified/intro.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/intro.js@7/minified/introjs.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 2em;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .diagram-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            min-height: 500px;
            border: 2px solid #e9ecef;
        }
        #architecture-diagram {
            width: 100%;
            height: 600px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        #workflow-diagram {
            width: 100%;
            height: 700px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .status-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status-box h3 {
            color: white;
            margin-bottom: 10px;
        }
        .status-box ul {
            margin-left: 20px;
        }
        .status-box li {
            margin: 8px 0;
        }
        .workflow-step {
            display: inline-block;
            padding: 12px 24px;
            margin: 8px 5px;
            background: #3498db;
            color: white;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .workflow-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .workflow-step.active {
            background: #27ae60;
            animation: pulse 2s infinite;
        }
        .workflow-step.completed {
            background: #95a5a6;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .arrow {
            display: inline-block;
            margin: 0 10px;
            color: #7f8c8d;
            font-size: 24px;
            font-weight: bold;
        }
        code {
            background: #f4f4f4;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ DDD Claims Processing System - Visualization Dashboard</h1>
        <div style="background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%); padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #2196F3;">
            <p style="font-size: 1.2em; color: #2c3e50; margin-bottom: 15px; line-height: 1.6;">
                <strong>Welcome to the Interactive Visualization Dashboard</strong>
            </p>
            <p style="font-size: 1.1em; color: #555; line-height: 1.7; margin-bottom: 15px;">
                This interactive dashboard provides a comprehensive view of the claims processing system architecture, 
                illustrating how components are organized, how information flows between bounded contexts, and how 
                processing workflows are coordinated. The visualizations demonstrate Domain-Driven Design principles 
                in practice.
            </p>
            <p style="font-size: 1.05em; color: #555; line-height: 1.7;">
                This dashboard documents the complete claim processing workflow‚Äîfrom unstructured input through 
                final routing. You'll explore the system architecture (bounded context organization), processing 
                workflows (temporal component interactions), and key DDD concepts. Each visualization is interactive‚Äî 
                click, hover, and explore to understand component relationships and system behavior.
            </p>
            <p style="font-size: 1.05em; color: #555; line-height: 1.7; margin-top: 15px; font-style: italic;">
                All concepts are grounded in established research on Domain-Driven Design (Evans, 2003) and 
                Event-Driven Architecture (Hohpe & Woolf, 2003). See <a href="REFERENCES.html" style="color: #2196F3;">REFERENCES.md</a> for complete citations.
            </p>
        </div>
        <button onclick="startTour()" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);" aria-label="Start guided tour of the visualization dashboard">
            üéØ Start Guided Tour
        </button>
    </div>

    <div class="container" data-intro="This diagram shows the complete system architecture with three bounded contexts: Policy Management (Supporting Domain), Claim Intake (Core Domain), and Fraud Assessment (Subdomain). Each context has clear boundaries and communicates through domain events (Evans, 2003)." data-step="1">
        <h2>üìê System Architecture: The Organizational Map</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #3498db;">
            <p style="margin: 0; line-height: 1.7; color: #2c3e50;">
                <strong>Architecture Overview:</strong> This diagram illustrates the system's organizational structure through 
                three bounded contexts, each with distinct responsibilities. The Claim Intake bounded context (Core Domain) 
                contains the primary business logic where claim processing occurs. Policy Management provides supporting services, 
                and Fraud Assessment is a specialized subdomain. Components communicate through domain events rather than 
                direct method calls, maintaining loose coupling and enabling independent evolution (Evans, 2003; Hohpe & Woolf, 2003).
            </p>
        </div>
        <p style="font-size: 1.05em; color: #555; margin: 15px 0;">The high-level architecture showing bounded contexts, components, and data flow:</p>
        <p style="background: #e7f3ff; padding: 10px; border-radius: 4px; margin: 10px 0;">
            <strong>üí° Interactive Exploration:</strong> Hover over or click nodes in the diagram below to see detailed explanations 
            of DDD concepts, patterns, and citations to research. Each tooltip provides technical explanations‚Äîhow components work, 
            why they're designed this way, and what research supports these patterns.
        </p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #90EE90;"></div>
                <span>Policy Management (Supporting Domain)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #87CEEB;"></div>
                <span>Claim Intake (Core Domain)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #D3D3D3;"></div>
                <span>Fraud Assessment (Subdomain)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9370DB;"></div>
                <span>Domain Events</span>
            </div>
        </div>
        
        <div class="diagram-container" data-intro="The architecture diagram is interactive! Click or hover over nodes to see tooltips explaining DDD concepts. Try clicking on 'Claim Intake (Core Domain)' or 'Intake Agent (LLM)' to learn more." data-step="2" role="region" aria-label="Interactive system architecture diagram">
            <div id="architecture-diagram" role="img" aria-label="System architecture showing three bounded contexts: Policy Management, Claim Intake, and Fraud Assessment, with their components and relationships"></div>
        </div>
    </div>

    <div class="container" data-intro="This sequence diagram shows the step-by-step workflow of processing a claim. Notice how domain events (like ClaimFactsExtracted) trigger the next steps, enabling loose coupling between components (Hohpe & Woolf, 2003)." data-step="3">
        <h2>üîÑ Workflow Sequence: The Journey of a Claim</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #27ae60;">
            <p style="margin: 0; line-height: 1.7; color: #2c3e50;">
                <strong>Workflow Sequence:</strong> This diagram documents the complete claim processing workflow, illustrating 
                temporal ordering of component interactions throughout the claim lifecycle. The sequence begins with claim 
                submission and proceeds through fact extraction, policy validation, fraud assessment, and routing decisions. 
                Then specialized workers (agents) process it: first extracting the key facts, then validating against policies, assessing 
                fraud risk, and finally routing it to the right destination. Notice how each step publishes a "notification" (domain event) 
                that wakes up the next worker‚Äîthis event-driven approach keeps everything loosely coupled and flexible (Hohpe & Woolf, 2003).
            </p>
        </div>
        <p style="font-size: 1.05em; color: #555; margin: 15px 0;">The step-by-step flow of processing a claim from input to final routing:</p>
        <p style="background: #e7f3ff; padding: 10px; border-radius: 4px; margin: 10px 0;">
            <strong>üìñ Reading the Flow:</strong> Read this diagram from top to bottom, following the arrows. Each horizontal line represents 
            a component (like an agent or repository), and the arrows show messages or actions. The sequence documents the complete workflow: 
            intake ‚Üí validation ‚Üí assessment ‚Üí routing ‚Üí completion. Notice how domain events (like ClaimFactsExtracted) trigger the next 
            steps‚Äîthis is the event-driven architecture in action, enabling loose coupling between components (Hohpe & Woolf, 2003).
        </p>
        <div class="diagram-container" role="region" aria-label="Workflow sequence diagram">
            <div id="workflow-diagram" role="img" aria-label="Sequence diagram showing the step-by-step workflow of processing a claim from user submission through intake, policy validation, fraud assessment, triage, and final routing"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Workflow Progress: Where Are We Now?</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
            <p style="margin: 0; line-height: 1.7; color: #2c3e50;">
                <strong>Status Visualization:</strong> This visualization indicates the current processing stage of a claim, providing real-time visibility into workflow progress. 
                Each step represents a milestone: Draft (just created), Facts Extracted (structured information extracted), Policy Validated 
                (coverage confirmed), Triaged (routing decision made), Processing (being handled), and Completed (finished). The active step 
                (highlighted in green) shows what's happening right now, while completed steps (gray) show what's already done.
            </p>
        </div>
        <p style="font-size: 1.05em; color: #555; margin: 15px 0;">Typical claim processing workflow steps:</p>
        <div class="status-box" style="background: white; color: #333;">
            <div class="workflow-step completed">üìù Draft</div>
            <span class="arrow">‚Üí</span>
            <div class="workflow-step completed">‚úÖ Facts Extracted</div>
            <span class="arrow">‚Üí</span>
            <div class="workflow-step active">üîç Policy Validated</div>
            <span class="arrow">‚Üí</span>
            <div class="workflow-step">üéØ Triaged</div>
            <span class="arrow">‚Üí</span>
            <div class="workflow-step">‚öôÔ∏è Processing</div>
            <span class="arrow">‚Üí</span>
            <div class="workflow-step">‚ú® Completed</div>
        </div>
    </div>

    <div class="container" data-intro="These are the key DDD concepts used in this system. Bounded Contexts separate domains, Domain Events enable communication, and Agents act as Anti-Corruption Layers (Evans, 2003)." data-step="4">
        <h2>üéØ Key Concepts: The Building Blocks</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9b59b6;">
            <p style="margin: 0; line-height: 1.7; color: #2c3e50;">
                <strong>DDD Concepts:</strong> These patterns provide structure for organizing complex software systems. Bounded Contexts 
                define clear boundaries with distinct domain models and business rules. 
                Domain Events are like inter-office memos that notify others when something important happens. Agents are specialized workers 
                that translate messy external data into clean, structured information. Together, these concepts create a system that's organized, 
                flexible, and maintainable (Evans, 2003; Vernon, 2013).
            </p>
        </div>
        <div class="status-box">
            <h3>Bounded Contexts: Separate Departments with Clear Boundaries</h3>
            <p style="margin-bottom: 10px;">Just like a company has separate departments (Sales, HR, Finance), this system has separate "bounded contexts" (Evans, 2003), each with its own rules and responsibilities:</p>
            <ul>
                <li><strong>Claim Intake</strong> (Core Domain) - The main business, where primary value is created. This is like the sales department‚Äîthe heart of the business.</li>
                <li><strong>Policy Management</strong> (Supporting Domain) - Provides essential services to the core domain. Like HR or IT, it supports the main business.</li>
                <li><strong>Fraud Assessment</strong> (Subdomain) - Specialized services that are important but not core. Like legal or compliance departments.</li>
            </ul>
            <p style="margin-top: 10px; font-style: italic; font-size: 0.95em;">Each context has clear boundaries and communicates with others through well-defined interfaces, keeping the system organized and maintainable.</p>
        </div>
        <div class="status-box">
            <h3>Domain Events: Notifications That Trigger Actions</h3>
            <p style="margin-bottom: 10px;">When something important happens in the system, it publishes a "domain event"‚Äîlike sending a memo to notify other departments (Vernon, 2013). These events trigger the next steps in the workflow:</p>
            <ul>
                <li>‚ö° <strong>ClaimFactsExtracted</strong> - Published when facts are successfully extracted from unstructured input. This wakes up the Policy Agent to start validation.</li>
                <li>‚ö° <strong>PolicyValidated</strong> - Published when policy check is complete. This triggers fraud assessment.</li>
                <li>‚ö° <strong>FraudScoreCalculated</strong> - Published when fraud assessment is done. This enables the final routing decision.</li>
            </ul>
            <p style="margin-top: 10px; font-style: italic; font-size: 0.95em;">This event-driven approach keeps components loosely coupled‚Äîthey don't need to know about each other directly, just listen for events (Hohpe & Woolf, 2003).</p>
        </div>
        <div class="status-box">
            <h3>Agents: AI-Powered Specialized Workers</h3>
            <p style="margin-bottom: 10px;">Agents are AI-powered workers that act as "translators" between messy external data and the clean, structured system. They use Large Language Models (LLMs) to understand unstructured input and extract structured information (Brown et al., 2020). This pattern is called an "Anti-Corruption Layer" (Evans, 2003)‚Äîit protects the system from bad data:</p>
            <ul>
                <li>ü§ñ <strong>Intake Agent</strong> - Acts like a claims analyst, reading customer emails and extracting key facts (date, location, amount, description). Uses prompt engineering to get structured output from unstructured input.</li>
                <li>üîç <strong>Policy Agent</strong> - Acts like a policy expert, validating whether a claim is covered by an active policy. Compares claim details against policy rules.</li>
                <li>üéØ <strong>Triage Agent</strong> - Acts like a routing specialist, deciding where the claim should go next based on all available information (policy status, fraud score, complexity).</li>
            </ul>
            <p style="margin-top: 10px; font-style: italic; font-size: 0.95em;">Each agent has a specific role and uses AI to perform domain-specific tasks, making the system intelligent and adaptable.</p>
        </div>
    </div>

    <div class="container">
        <h2>üöÄ How to Use: Exploring the System</h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #e74c3c;">
            <p style="margin: 0; line-height: 1.7; color: #2c3e50;">
                <strong>Exploration Guide:</strong> This dashboard is designed for systematic exploration. Start with the guided tour to get oriented, 
                then explore the interactive diagrams. Click on nodes to learn about concepts, follow the workflow to understand processing flows, 
                and use the progress indicators to see where claims are in the process. The more you explore, the more you'll understand how 
                all the pieces fit together.
            </p>
        </div>
        <div class="info-box">
            <p><strong>Interactive Features: Making Diagrams Come Alive</strong></p>
            <p style="margin-top: 10px; margin-bottom: 10px;">The diagrams in this dashboard are fully interactive. Here's how to explore them:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Drag nodes</strong> to rearrange the diagrams and see relationships from different angles</li>
                <li><strong>Zoom</strong> using mouse wheel or pinch gesture to focus on specific areas</li>
                <li><strong>Click nodes</strong> to see detailed tooltips explaining concepts, patterns, and research citations</li>
                <li><strong>Hover over nodes</strong> for quick information without clicking</li>
                <li><strong>Pan</strong> by dragging the background to navigate large diagrams</li>
                <li><strong>Keyboard navigation</strong> is supported for accessibility‚Äîuse Tab to navigate and Enter to activate</li>
            </ul>
        </div>
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
            <p><strong>üìñ Getting the Most from This Dashboard:</strong></p>
            <ol style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li><strong>Start with the Guided Tour</strong>: Click "Start Guided Tour" above to get an overview of all features and concepts</li>
                <li><strong>Explore the Architecture</strong>: Click on different nodes in the architecture diagram to understand how components relate</li>
                <li><strong>Follow the Workflow</strong>: Trace claim processing through the sequence diagram to see the complete workflow</li>
                <li><strong>Run Interactive Tools</strong>: Execute <code>python scripts/visualize.py</code> for real-time terminal visualization of actual claim processing</li>
                <li><strong>Export for Reference</strong>: Right-click on diagrams to save as images for presentations or documentation</li>
            </ol>
        </div>
        <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #17a2b8;">
            <p><strong>‚ôø Accessibility Features:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li>All diagrams include ARIA labels for screen readers</li>
                <li>Keyboard navigation is fully supported (Tab, Enter, Arrow keys)</li>
                <li>Tooltips are accessible and can be read by screen readers</li>
                <li>Color is not the only way information is conveyed‚Äîshapes and labels also carry meaning</li>
                <li>Text descriptions are provided for all visual elements</li>
            </ul>
        </div>
    </div>

    <script type="text/javascript">
        // Architecture Diagram
        var architectureNodes = new vis.DataSet([
            // Bounded Contexts
            {id: 1, label: 'Policy Management\n(Supporting Domain)', group: 'policy', shape: 'box', color: {background: '#90EE90', border: '#006400'}},
            {id: 2, label: 'Claim Intake\n(Core Domain)', group: 'claim', shape: 'box', color: {background: '#87CEEB', border: '#0000CD'}},
            {id: 3, label: 'Fraud Assessment\n(Subdomain)', group: 'fraud', shape: 'box', color: {background: '#D3D3D3', border: '#696969'}},
            
            // Claim Intake Components
            {id: 4, label: 'Unstructured\nCustomer Data', group: 'claim', shape: 'ellipse', color: {background: '#E3F2FD'}},
            {id: 5, label: 'Intake Agent\n(LLM)', group: 'claim', shape: 'diamond', color: {background: '#FFF9C4'}},
            {id: 6, label: 'Prompt\nEngineering', group: 'claim', shape: 'box', color: {background: '#F3E5F5'}},
            {id: 7, label: 'Policy\nRepository', group: 'policy', shape: 'database', color: {background: '#E8F5E9'}},
            {id: 8, label: 'Policy\n(Aggregate)', group: 'policy', shape: 'box', color: {background: '#E8F5E9'}},
            {id: 9, label: 'ClaimFact\nExtravice', group: 'claim', shape: 'hexagon', color: {background: '#4169E1', font: {color: 'white'}}},
            {id: 10, label: 'ClaimSummary\n(Value Object)', group: 'claim', shape: 'box', color: {background: '#E1F5FE'}},
            {id: 11, label: 'ClaimFactsExtracted\n(Domain Event)', group: 'event', shape: 'triangle', color: {background: '#9370DB', font: {color: 'white'}}},
            
            // Fraud Assessment
            {id: 12, label: 'FraudCheckResult', group: 'fraud', shape: 'box', color: {background: '#FFF3E0'}},
            {id: 13, label: 'ML Fraud Model', group: 'fraud', shape: 'box', color: {background: '#FFE0B2'}},
            
            // Workflow Orchestrator
            {id: 14, label: 'Workflow\nOrchestrator', group: 'orchestrator', shape: 'box', color: {background: '#C0C0C0', border: '#808080'}},
            {id: 15, label: 'PolicyValidated\n(Domain Event)', group: 'event', shape: 'triangle', color: {background: '#9370DB', font: {color: 'white'}}},
            {id: 16, label: 'FraudScoreCalculated\n(Domain Event)', group: 'event', shape: 'triangle', color: {background: '#9370DB', font: {color: 'white'}}},
            {id: 17, label: 'Policy Validation\nAgent', group: 'orchestrator', shape: 'diamond', color: {background: '#E1BEE7'}},
            {id: 18, label: 'Triage & Routing\nAgent (1)', group: 'orchestrator', shape: 'diamond', color: {background: '#E1BEE7'}},
            {id: 19, label: 'Triage & Routing\nAgent (2)', group: 'orchestrator', shape: 'diamond', color: {background: '#E1BEE7'}},
            {id: 20, label: 'Downstream Systems\n(Human Adjudicator Queue)', group: 'orchestrator', shape: 'box', color: {background: '#C8E6C9'}},
        ]);

        var architectureEdges = new vis.DataSet([
            {from: 4, to: 5, label: 'Unstructured Input', arrows: 'to'},
            {from: 6, to: 5, label: 'System Prompt', arrows: 'to'},
            {from: 7, to: 8, label: 'Policy Data', arrows: 'to'},
            {from: 8, to: 5, label: 'Reference', arrows: 'to', dashes: true},
            {from: 5, to: 9, label: 'Extracted Facts', arrows: 'to'},
            {from: 9, to: 10, label: 'Structured Summary', arrows: 'to'},
            {from: 9, to: 11, label: 'Publishes', arrows: 'to'},
            {from: 10, to: 12, label: 'Claim Summary', arrows: 'to'},
            {from: 12, to: 13, label: 'Assessment', arrows: 'to'},
            {from: 11, to: 14, label: 'Triggers', arrows: 'to'},
            {from: 14, to: 15, label: 'Publishes', arrows: 'to'},
            {from: 14, to: 16, label: 'Publishes', arrows: 'to'},
            {from: 15, to: 17, label: 'Triggers', arrows: 'to'},
            {from: 17, to: 18, label: 'Routes', arrows: 'to'},
            {from: 16, to: 19, label: 'Triggers', arrows: 'to'},
            {from: 18, to: 19, label: 'Routes', arrows: 'to'},
            {from: 19, to: 20, label: 'Dispatches', arrows: 'to'},
        ]);

        var architectureData = {
            nodes: architectureNodes,
            edges: architectureEdges
        };

        var architectureOptions = {
            nodes: {
                font: {size: 14, face: 'Arial'},
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: {to: {enabled: true}},
                font: {size: 11, align: 'middle'},
                smooth: {type: 'continuous', roundness: 0.5}
            },
            layout: {
                hierarchical: {
                    enabled: false
                }
            },
            physics: {
                enabled: true,
                stabilization: {iterations: 200}
            },
            groups: {
                policy: {color: {background: '#90EE90'}},
                claim: {color: {background: '#87CEEB'}},
                fraud: {color: {background: '#D3D3D3'}},
                event: {color: {background: '#9370DB'}},
                orchestrator: {color: {background: '#C0C0C0'}}
            }
        };

        var architectureNetwork = new vis.Network(document.getElementById('architecture-diagram'), architectureData, architectureOptions);

        // Workflow Sequence Diagram
        var workflowNodes = new vis.DataSet([
            {id: 1, label: 'User', level: 0, shape: 'icon', icon: {face: 'FontAwesome', code: '\f007', size: 50, color: '#2c3e50'}},
            {id: 2, label: 'Orchestrator', level: 1, shape: 'box', color: {background: '#3498db'}},
            {id: 3, label: 'Intake Agent', level: 2, shape: 'diamond', color: {background: '#e74c3c'}},
            {id: 4, label: 'LLM\n(Ollama/OpenAI)', level: 3, shape: 'ellipse', color: {background: '#f39c12'}},
            {id: 5, label: 'Claim\nRepository', level: 1, shape: 'database', color: {background: '#9b59b6'}},
            {id: 6, label: 'Policy Agent', level: 2, shape: 'diamond', color: {background: '#e74c3c'}},
            {id: 7, label: 'Policy\nRepository', level: 1, shape: 'database', color: {background: '#9b59b6'}},
            {id: 8, label: 'Fraud\nAssessment', level: 2, shape: 'diamond', color: {background: '#e74c3c'}},
            {id: 9, label: 'Triage Agent', level: 2, shape: 'diamond', color: {background: '#e74c3c'}},
            {id: 10, label: 'Downstream\nSystems', level: 1, shape: 'box', color: {background: '#27ae60'}},
        ]);

        var workflowEdges = new vis.DataSet([
            {from: 1, to: 2, label: 'Submit Claim', arrows: 'to'},
            {from: 2, to: 5, label: 'Create Claim', arrows: 'to'},
            {from: 5, to: 2, label: 'Claim Created', arrows: 'to'},
            {from: 2, to: 3, label: 'Extract Facts', arrows: 'to'},
            {from: 3, to: 4, label: 'Send Email + Prompt', arrows: 'to'},
            {from: 4, to: 3, label: 'Return JSON', arrows: 'to'},
            {from: 3, to: 5, label: 'Update Claim', arrows: 'to'},
            {from: 3, to: 2, label: 'Publish Event', arrows: 'to'},
            {from: 2, to: 6, label: 'Validate Policy', arrows: 'to'},
            {from: 6, to: 7, label: 'Find Policies', arrows: 'to'},
            {from: 7, to: 6, label: 'Return Policies', arrows: 'to'},
            {from: 6, to: 4, label: 'Send Claim + Policies', arrows: 'to'},
            {from: 4, to: 6, label: 'Return Result', arrows: 'to'},
            {from: 6, to: 5, label: 'Update Status', arrows: 'to'},
            {from: 2, to: 8, label: 'Assess Fraud', arrows: 'to'},
            {from: 8, to: 4, label: 'Analyze Claim', arrows: 'to'},
            {from: 4, to: 8, label: 'Return Score', arrows: 'to'},
            {from: 2, to: 9, label: 'Route Claim', arrows: 'to'},
            {from: 9, to: 4, label: 'Determine Route', arrows: 'to'},
            {from: 4, to: 9, label: 'Return Decision', arrows: 'to'},
            {from: 9, to: 5, label: 'Update Status', arrows: 'to'},
            {from: 9, to: 10, label: 'Dispatch', arrows: 'to'},
            {from: 10, to: 1, label: 'Claim Processed', arrows: 'to'},
        ]);

        var workflowData = {
            nodes: workflowNodes,
            edges: workflowEdges
        };

        var workflowOptions = {
            nodes: {
                font: {size: 14, face: 'Arial'},
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: {to: {enabled: true}},
                font: {size: 11, align: 'middle'},
                smooth: {type: 'continuous', roundness: 0.3}
            },
            layout: {
                hierarchical: {
                    enabled: true,
                    direction: 'LR',
                    sortMethod: 'directed',
                    levelSeparation: 150,
                    nodeSpacing: 200
                }
            },
            physics: {
                enabled: false
            }
        };

        var workflowNetwork = new vis.Network(document.getElementById('workflow-diagram'), workflowData, workflowOptions);
        
        // Tooltip content for architecture diagram nodes - Enhanced with narrative storytelling
        const tooltipContent = {
            1: 'Policy Management (Supporting Domain)<br><small><strong>The Story:</strong> Like the HR or IT department in a company, Policy Management provides essential services that support the core business. It doesn\'t create the primary value, but the core domain couldn\'t function without it. In Domain-Driven Design, supporting domains help the core domain function but aren\'t the primary business value (Evans, 2003). This bounded context manages insurance policies and provides validation services to the Claim Intake domain. <strong>Reference:</strong> <a href="REFERENCES.html#policy-management">Evans (2003)</a></small>',
            2: 'Claim Intake (Core Domain)<br><small><strong>The Story:</strong> This is the heart of the business‚Äîwhere the primary value is created. Think of it like the sales department in a company: everything else exists to support this core function. The Claim Intake bounded context receives messy, unstructured customer input and transforms it into structured, processable claims. This is where the magic happens‚Äîwhere customer needs meet business capabilities. <strong>Reference:</strong> <a href="REFERENCES.html#domain-driven-design">Evans (2003)</a></small>',
            3: 'Fraud Assessment (Subdomain)<br><small><strong>The Story:</strong> Important but not core to the business, Fraud Assessment is like a specialized department (legal or compliance) that provides critical services. It\'s essential for risk management but not the primary business function. This subdomain uses both machine learning models and LLM agents to assess fraud risk, providing scores that help route claims appropriately. <strong>Reference:</strong> <a href="REFERENCES.html#domain-driven-design">Evans (2003)</a></small>',
            4: 'Unstructured Customer Data<br><small><strong>Overview:</strong> Claims originate as unstructured input (emails, forms, notes) containing necessary information in formats requiring transformation. This raw input serves as the entry point for agent processing, where unstructured data is transformed into structured domain models through fact extraction.</small>',
            5: 'Intake Agent (LLM)<br><small><strong>The Story:</strong> This AI agent acts like a skilled claims analyst who can read messy customer emails and extract the key facts. It uses Large Language Models (Brown et al., 2020) combined with prompt engineering to understand unstructured input and produce structured output. This is an "Anti-Corruption Layer" (Evans, 2003)‚Äîit protects the clean, structured system from messy external data. The agent translates customer language into domain language. <strong>Reference:</strong> <a href="REFERENCES.html#llmai-agents">Brown et al. (2020)</a>, <a href="REFERENCES.html#anti-corruption-layer">Evans (2003)</a></small>',
            6: 'Prompt Engineering<br><small><strong>The Story:</strong> Prompt engineering is the art of crafting instructions that make AI models act like domain experts. It\'s like writing a job description so detailed that the AI knows exactly how to behave. By carefully designing prompts, we can get structured, validated output from unstructured input. Techniques like chain-of-thought prompting (Wei et al., 2022) help models reason through complex tasks. <strong>Reference:</strong> <a href="REFERENCES.html#llmai-agents">Wei et al. (2022)</a></small>',
            7: 'Policy Repository<br><small><strong>The Story:</strong> Like a filing cabinet for policies, the Policy Repository abstracts how policies are stored and retrieved. This follows the Repository pattern (Evans, 2003; Fowler, 2002), which keeps the domain model independent of how data is persisted. The domain doesn\'t care if policies are in a database, file system, or cloud storage‚Äîit just asks the repository for what it needs. This makes the system flexible and testable. <strong>Reference:</strong> <a href="REFERENCES.html#repository-pattern">Evans (2003), Fowler (2002)</a></small>',
            8: 'Policy (Aggregate)<br><small><strong>The Story:</strong> An Aggregate Root representing an insurance policy. In Domain-Driven Design, aggregates are consistency boundaries‚Äîthey ensure that all related data stays consistent. Think of it like a contract: all the terms, coverage details, and rules must be consistent with each other. The aggregate enforces business rules and maintains this consistency. Only aggregate roots can be referenced from outside the aggregate (Evans, 2003; Vernon, 2013). <strong>Reference:</strong> <a href="REFERENCES.html#aggregate-pattern">Evans (2003), Vernon (2013)</a></small>',
            9: 'ClaimFact Extravice<br><small><strong>The Story:</strong> This is the core service at the heart of the Claim Intake bounded context. It\'s like the main processing desk where all the work happens. The service coordinates fact extraction, validates the results, and creates domain objects. It\'s where unstructured input becomes structured domain models, where chaos becomes order. This service orchestrates the entire fact extraction process.</small>',
            10: 'ClaimSummary (Value Object)<br><small><strong>The Story:</strong> A Value Object is like a business card‚Äîit\'s defined entirely by its attributes, not by an identity. Two ClaimSummary objects with the same facts are considered equal, even if they\'re different objects in memory. This immutability and value-based equality make value objects perfect for representing structured data like claim facts. Once created, a ClaimSummary never changes‚Äîif you need different facts, you create a new one (Evans, 2003). <strong>Reference:</strong> <a href="REFERENCES.html#value-objects">Evans (2003)</a></small>',
            11: 'ClaimFactsExtracted (Domain Event)<br><small><strong>The Story:</strong> When facts are successfully extracted, this domain event is published‚Äîlike sending a memo to notify other departments. The event says "Hey, I finished extracting facts from this claim!" and other parts of the system can listen and react. This event-driven approach (Hohpe & Woolf, 2003) keeps components loosely coupled. The Policy Agent doesn\'t need to know about the Intake Agent directly‚Äîit just listens for this event. <strong>Reference:</strong> <a href="REFERENCES.html#domain-events">Vernon (2013)</a>, <a href="REFERENCES.html#event-driven-architecture">Hohpe & Woolf (2003)</a></small>',
            12: 'FraudCheckResult<br><small><strong>The Story:</strong> A Value Object containing the results of fraud assessment. Like a report card, it contains a score, risk level, and reasons for the assessment. This immutable object is created once when fraud assessment completes and never changes. If you need to reassess, you create a new FraudCheckResult. This immutability ensures data integrity and makes the system easier to reason about.</small>',
            13: 'ML Fraud Model<br><small><strong>The Story:</strong> A machine learning model trained to detect fraud patterns. Like a security guard who\'s seen thousands of cases, this model recognizes suspicious patterns that might indicate fraud. It can work alongside LLM-based assessment, providing both statistical analysis and semantic understanding. The model analyzes claim characteristics, historical patterns, and risk indicators to produce fraud scores.</small>',
            14: 'Workflow Orchestrator<br><small><strong>The Story:</strong> Like a conductor leading an orchestra, the Workflow Orchestrator coordinates all the components. It doesn\'t do the work itself‚Äîit listens for domain events and tells the right agents to start working. When it hears "ClaimFactsExtracted," it tells the Policy Agent to start. This event-driven coordination (Hohpe & Woolf, 2003) enables loose coupling and makes the system flexible and maintainable. <strong>Reference:</strong> <a href="REFERENCES.html#event-driven-architecture">Hohpe & Woolf (2003)</a></small>',
            15: 'PolicyValidated (Domain Event)<br><small><strong>The Story:</strong> After the Policy Agent finishes validating a claim against policies, it publishes this event. It\'s like a department sending a memo saying "Policy check complete!" The event contains the validation result, and other components (like the Fraud Agent) can listen and react. This event-driven communication keeps the system flexible‚Äînew components can listen to events without modifying existing code. <strong>Reference:</strong> <a href="REFERENCES.html#domain-events">Vernon (2013)</a></small>',
            16: 'FraudScoreCalculated (Domain Event)<br><small><strong>The Story:</strong> When fraud assessment completes, this event is published with the fraud score and risk level. Like a notification that "Fraud assessment is done," this event enables the final routing decision. The Triage Agent listens for this event (along with PolicyValidated) to make informed routing decisions. This event-driven approach means the Triage Agent doesn\'t need to know how fraud assessment works‚Äîit just waits for the result. <strong>Reference:</strong> <a href="REFERENCES.html#domain-events">Vernon (2013)</a></small>',
            17: 'Policy Validation Agent<br><small><strong>The Story:</strong> This AI agent acts like a policy expert who can read claim details and policy documents, then determine if the claim is covered. It uses LLMs to understand both the claim and the policy language, making intelligent decisions about coverage. As an Anti-Corruption Layer (Evans, 2003), it translates between the Policy Management context and the Claim Intake context, ensuring clean communication between bounded contexts.</small>',
            18: 'Triage & Routing Agent<br><small><strong>The Story:</strong> Like a dispatcher in a call center, this AI agent looks at all available information (policy status, fraud score, claim complexity) and decides where the claim should go next. Should it go to human review? Automated processing? Fraud investigation? The agent makes this decision intelligently, considering all factors. It\'s the final decision-maker before claims reach downstream systems.</small>',
            19: 'Triage & Routing Agent<br><small><strong>The Story:</strong> This second routing agent makes the final dispatch decision after all information is gathered. It considers policy validation results, fraud scores, and business rules to route claims to the most appropriate destination. Like a quality control inspector, it ensures claims go to the right place based on all available information.</small>',
            20: 'Downstream Systems<br><small><strong>The Story:</strong> The final destination for processed claims. Like different departments in a company, downstream systems handle different types of claims. High-risk claims might go to human adjudicator queues for careful review. Low-risk claims might go to automated processing for fast handling. Suspicious claims go to fraud investigation. This is where the claim\'s journey through our system ends and its next phase begins.</small>'
        };
        
        // Add tooltips to architecture diagram nodes
        architectureNetwork.on("click", function (params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const content = tooltipContent[nodeId] || 'Click nodes to learn more about DDD concepts.';
                if (content) {
                    tippy(params.event.target, {
                        content: content,
                        allowHTML: true,
                        theme: 'light-border',
                        placement: 'right',
                        interactive: true,
                        maxWidth: 400
                    });
                }
            }
        });
        
        // Add hover tooltips
        architectureNetwork.on("hoverNode", function (params) {
            const nodeId = params.node;
            const content = tooltipContent[nodeId];
            if (content) {
                const nodeElement = document.querySelector(`[data-node-id="${nodeId}"]`);
                if (nodeElement) {
                    tippy(nodeElement, {
                        content: content,
                        allowHTML: true,
                        theme: 'light-border',
                        placement: 'right',
                        interactive: true,
                        maxWidth: 400
                    });
                }
            }
        });
        
        // Guided Tour
        function startTour() {
            introJs().setOptions({
                steps: [
                    {
                        intro: "Welcome to the DDD Claims Processing System Dashboard!<br><br>This interactive dashboard tells the story of how claims are processed‚Äîfrom a customer's unstructured email to final routing. You'll explore the architecture (how departments are organized), the workflow (how claims travel), and the key concepts that make it all work.<br><br>This guided tour will help you understand the key concepts and how to interact with the visualizations. Each diagram tells part of the system's story, and together they create a complete picture.<br><br>Click 'Next' to begin your journey!"
                    },
                    {
                        element: '.container[data-step="1"]',
                        intro: "This is the System Architecture diagram‚Äîthink of it as an organizational chart for software. It shows three Bounded Contexts (Evans, 2003), each like a separate department:<br><br>‚Ä¢ <strong>Claim Intake</strong> (Core Domain) - The main business, where primary value is created‚Äîlike the sales department<br>‚Ä¢ <strong>Policy Management</strong> (Supporting Domain) - Provides essential services‚Äîlike HR or IT<br>‚Ä¢ <strong>Fraud Assessment</strong> (Subdomain) - Specialized services‚Äîlike legal or compliance<br><br>Each context has clear boundaries and communicates through domain events (like inter-office memos), keeping them independent and flexible."
                    },
                    {
                        element: '.diagram-container[data-step="2"]',
                        intro: "The diagram is fully interactive‚Äîexplore it like a map!<br><br>‚Ä¢ <strong>Click nodes</strong> to see detailed tooltips that tell the story of each component, with DDD explanations and research citations<br>‚Ä¢ <strong>Hover over nodes</strong> for quick information<br>‚Ä¢ <strong>Drag nodes</strong> to rearrange and see relationships from different angles<br>‚Ä¢ <strong>Zoom</strong> with mouse wheel to focus on specific areas<br>‚Ä¢ <strong>Pan</strong> by dragging the background to navigate<br><br>Try clicking on 'Intake Agent (LLM)' to learn how it acts as an Anti-Corruption Layer (Evans, 2003), translating messy customer data into clean, structured information."
                    },
                    {
                        element: '.container[data-step="3"]',
                        intro: "This sequence diagram shows the complete journey of a claim‚Äîlike watching a package move through a shipping facility. Read it from top to bottom, following the arrows.<br><br>Notice how:<br>‚Ä¢ Domain Events (like ClaimFactsExtracted) trigger the next workflow steps‚Äîlike notifications that wake up the next worker<br>‚Ä¢ Components are loosely coupled‚Äîthey don't directly call each other, they listen for events<br>‚Ä¢ The Orchestrator coordinates everything‚Äîlike a conductor leading an orchestra<br><br>This follows Event-Driven Architecture principles (Hohpe & Woolf, 2003), making the system flexible and maintainable."
                    },
                    {
                        element: '.container[data-step="4"]',
                        intro: "These are the key building blocks that make the system work:<br><br>‚Ä¢ <strong>Bounded Contexts</strong> - Like separate departments in a company, each with clear boundaries and responsibilities (Evans, 2003)<br>‚Ä¢ <strong>Domain Events</strong> - Like inter-office memos, notifications that trigger workflow steps and keep components loosely coupled (Vernon, 2013)<br>‚Ä¢ <strong>Agents</strong> - AI-powered specialized workers that translate messy external data into clean, structured information (Brown et al., 2020)<br><br>All concepts are grounded in established research. See REFERENCES.md for complete citations in APA format."
                    },
                    {
                        intro: "You're all set to explore!<br><br>‚Ä¢ <strong>Explore the diagrams interactively</strong> - Click, hover, and drag to discover the system's story<br>‚Ä¢ <strong>Check out REFERENCES.md</strong> for complete research citations in APA format<br>‚Ä¢ <strong>Run <code>python scripts/visualize.py</code></strong> for real-time terminal visualization of actual claim processing<br>‚Ä¢ <strong>Read the narrative sections</strong> to understand the story behind each visualization<br><br>Remember: Each visualization tells part of the system's story. The more you explore, the more you'll understand how all the pieces fit together. Happy learning! üéì"
                    }
                ],
                showProgress: true,
                showBullets: false,
                exitOnOverlayClick: true,
                exitOnEsc: true,
                nextLabel: 'Next ‚Üí',
                prevLabel: '‚Üê Previous',
                doneLabel: 'Done'
            }).start();
        }
    </script>
</body>
</html>
